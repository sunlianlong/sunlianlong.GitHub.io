(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{617:function(s,n,a){"use strict";a.r(n);var t=a(3),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"简单命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简单命令"}},[s._v("#")]),s._v(" 简单命令：")]),s._v(" "),a("ol",[a("li",[s._v("启动nginx：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd Program Files (x86)/nginx-1.11.7/\nnginx\n\npause\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("测试 nginx 配置：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("nginx -t reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("重启 nginx ：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("nginx -s reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("关闭 nginx：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("nginx -s stop\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置：")]),s._v(" "),a("ol",[a("li",[s._v("首先找到nginx.conf或者nginx.conf.default 或者是default里面的这部分，并增加修改:")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server {\n    listen       80;\n    server_name  localhost;\n\n    #charset koi8-r;\n\n    #access_log  logs/host.access.log  main;\n\n    location / {  \t\t\t#所有以/开头的地址，实际上是所有请求\n        root /data/qianduan;  \t\t#请求访问的文件地址\n        index  index.html index.htm;    #首页响应地址\n    }\n     location /getjson/{  \t\t#代理服务端请求\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-Ip $remote_addr;\n            proxy_set_header X-Forwarded-For $remote_addr;\n            proxy_pass http://127.0.0.1:8091/; #服务端真实地址\n\t}\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h2",{attrs:{id:"前端使用方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端使用方法"}},[s._v("#")]),s._v(" 前端使用方法：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('var url = "/getjson/";\n$.ajax({\n\turl: url + "get/data",\n\ttype: "post",\n\tdataType: "json",\n\tdata: JSON.stringify({"id":1})\n}).done(function(res){\n\tconsole.log(res);\n});\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("nginx 配置 ssl：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" server {\n\t listen       443;\n \tserver_name  ted.sunlianlong.top; # 改你的host\n \troot /data/php/; # 根目录为web\n \tindex index.php;\n\t access_log  /var/log/nginx/php.access.log;\n\t error_log  /var/log/nginx/php.error.log;\n \tssl on;  # 设置ssl打开\n \tssl_certificate   /usr/share/nginx/server.pem;  # 从https提供方获取\n \tssl_certificate_key /usr/share/nginx/server.key; # 从https提供方获取\n\n\tlocation / {\n\t\ttry_files $uri $uri/ /index.php$is_args$args;\n\t}\n\n\tlocation /yy {\n\t\tproxy_pass http://www.51changke.com:80/;\n\t}\n\n\tlocation ~ \\.php$ {\n\t\ttry_files $uri = 404;\n\t\tfastcgi_pass   127.0.0.1:9000;\n\t\tfastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;\n\t\tinclude        fastcgi_params;\n\t}\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h1",{attrs:{id:"nginx-正式环境、测试环境-nginx解决了跨域问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-正式环境、测试环境-nginx解决了跨域问题"}},[s._v("#")]),s._v(" nginx----正式环境、测试环境，nginx解决了跨域问题")]),s._v(" "),a("h3",{attrs:{id:"一、nginx代理配置方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、nginx代理配置方法"}},[s._v("#")]),s._v(" 一、nginx代理配置方法：")]),s._v(" "),a("p",[s._v("使用nginx配置服务器环境：")]),s._v(" "),a("ol",[a("li",[s._v("conf ==> nginx.conf中添加：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location /apisdk/ {这个地方对应JS文件中的url声明}{\n\tproxy_set_header Host $host;\n\tproxy_set_header X-Real-Ip $remote_addr;\n\tproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\tproxy_pass  http://115.236.19.138:9787/; 这里是服务器地址；\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("使用方法：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('var url = "/apisdk/";\n发送请求  url: url+"getFindList",\n服务器地址：http://115.236.19.138:9787/getFindList;\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("测试环境与正式环境都按照相同的方法配置")]),s._v(" "),a("h3",{attrs:{id:"二、nginx打印代理后的post请求参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、nginx打印代理后的post请求参数"}},[s._v("#")]),s._v(" 二、nginx打印代理后的post请求参数：")]),s._v(" "),a("p",[s._v("由于代码都是运行在客户端中，当调试某种bug时常常需要复现错误场景，但是有些时候是无法还原的，那么在前端中能否有后台的日志系统么？答案是有的，那就是使用nginx的日志系统")]),s._v(" "),a("h4",{attrs:{id:"第一种方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一种方法"}},[s._v("#")]),s._v(" 第一种方法：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("场景及限制：\n1. 必须使用nginx代理\n2. nginx中想利用$request_body命令只有location中用到proxy_pass,fastcgi_pass,scgi_pass命令时，该变量才有值\n3. 仅依赖nginx，不需要其他环境\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("步骤：")]),s._v(" "),a("ol",[a("li",[s._v("在 nginx.conf的中http配置log_format 变量")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('http {\n    log_format  main  \'$remote_addr - $remote_user [$time_local] "$request" \'\n                      \'$status $body_bytes_sent "$http_referer" \'\n                      \'"$http_user_agent" "$http_x_forwarded_for"\';\n                      \n    log_format  dm escape=json \'$remote_addr - $remote_user [$time_local] "$request" \'\n                               \'$status $body_bytes_sent "$http_referer" \'\n                               \'"$http_user_agent" "$http_x_forwarded_for" "$request_body"\';\n     \n    access_log  /var/log/nginx/access.log main;\n    \n    \n    include /etc/nginx/conf.d/*.conf;\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("说明：log_format 为必须，main和 dm为后面在记录 access_log和error_log中需要使用的变量名，后面的字符串为需要输出的日志字符串，注意在 "),a("strong",[s._v("dm")]),s._v(" 中有一个 "),a("strong",[s._v("escape=json")]),s._v("表示以json字符串的格式输出，如果缺少此项则会输出类似：\\x22 \\x9B \\x5C \\x09 \\x08 等字符，不便于阅读和处理。")]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("在conf.d下的的 .conf的server中，找到需要添加body日志的localtion中配置access_log和error_log")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server {\n    listen       8560;   # 定向流量SDK\n    server_name  wxqas.yayaim.com;\n    access_log  /var/log/nginx/localhost.access.log;\n    error_log  /var/log/nginx/localhost.error.log;\n    client_max_body_size     10m;\n\n    location / {\n            index index.html index.php;\n            root /data/vueprograms/dingxiangsdk/dist;\n            try_files $uri $uri/ /index.html;\n    }#end\n    location /dingxiangsdk/{\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-Ip $remote_addr;\n            proxy_set_header X-Forwarded-For $remote_addr;\n            proxy_pass http://127.0.0.1:8091/;\n            access_log /var/log/nginx/localhost.access.log dm;\n    }#定向流量sdk\n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("注意：\naccess_log一定要放到location中，不要直接替换server中的access_log，原因在于替换后其他的请求都不会被输出到日志中，只有post请求会放到日志中")]),s._v(" "),a("h4",{attrs:{id:"第二种方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二种方法"}},[s._v("#")]),s._v(" 第二种方法：")]),s._v(" "),a("p",[s._v("使用lua语言来获取request_body，据说很方便，日后什么时候学习lua再研究这种方法\n更新2018-09-14：阿里云服务器已经添加 openresty 集成了 nginx_lua")]),s._v(" "),a("p",[s._v("参考资料：\n"),a("a",{attrs:{href:"http://blog.csdn.net/yangguanghaozi/article/details/52367118",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx 获取 post body值"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.im/post/5949e0f7128fe1006a627cc0",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx日志中$request_body 十六进制字符(\\x22\\x9B\\x5C\\x09\\x08...)完美解决方案"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"三、nginx配置html文件无缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、nginx配置html文件无缓存"}},[s._v("#")]),s._v(" 三、nginx配置html文件无缓存")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location / {\n        index index.html index.php; // 访问根目录默认文件\n        root /data/gslh5;   // 代理根目录\n        try_files $uri $uri/ /index.html; // vue使用\n        add_header Cache-Control no-store; // 无缓存头\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])])}),[],!1,null,null,null);n.default=e.exports}}]);